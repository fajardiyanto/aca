{{ define "content" }}
<div class="justify-content-center data-body">
  <div class="m-3">
    <h1 class="text-center">Create Permit</h1>
    <form id="create-permit" method="post" enctype="multipart/form-data">
      <div class="form-group">
        <div class="form-group">
          <label for="inputName">Nama*</label>
          <input
            id="name-permit"
            type="text"
            class="form-control"
            name="name"
            placeholder="Name"
            required
          />
        </div>
        <label for="inputRegion">Region*</label>
        <input
          id="reg-permit"
          type="text"
          class="form-control"
          name="region"
          placeholder="Region"
          required
        />
      </div>
      <div class="form-group">
        <label for="inputNik">NIK*</label>
        <input
          id="nik-permit"
          type="text"
          class="form-control"
          name="nik"
          placeholder="NIK"
          required
        />
      </div>
      <div class="form-group">
        <label for="inputCompany">Perusahaan*</label>
        <input
          id="company-permit"
          type="text"
          class="form-control"
          name="company"
          placeholder="Perusahaan"
          required
        />
      </div>
      <div class="form-group">
        <label for="inputDepartement">Departemen*</label>
        <input
          id="departement-permit"
          type="text"
          class="form-control"
          name="departement"
          placeholder="Departemen"
          required
        />
      </div>
      <div class="form-group">
        <label for="inputPosition">Jabatan*</label>
        <input
          id="position-permit"
          type="text"
          class="form-control"
          name="position"
          placeholder="Jabatan"
          required
        />
      </div>
      <div class="form-group">
        <label for="datepicker">Valid Date*</label>
        <input
          type="date"
          class="form-control"
          name="valid"
          id="datepicker"
          required
        />
      </div>
      <div class="form-group">
        <label for="imagePermit">Photo Profile</label>
        <input
          type="file"
          class="form-control-file"
          id="imagePermit"
          name="file"
          onchange="preview()"
        />
        <img id="frame" src="" class="m-2 image-preview" />
      </div>
      <button
        type="submit"
        class="btn btn-primary float-right create-permit-btn"
      >
        Submit
      </button>
    </form>
  </div>
</div>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"
></script>
<script>
  $(document).ready(function () {
    var id = new URLSearchParams(window.location.search).get("id");

    $.ajax({
      url: "/detail/permit?id=" + id,
      method: "get",
      success: function (data) {
        document.getElementById("name-permit").value = data.name;
        document.getElementById("nik-permit").value = data.nik;
        document.getElementById("reg-permit").value = data.region;
        document.getElementById("company-permit").value = data.company;
        document.getElementById("departement-permit").value = data.departement;
        document.getElementById("position-permit").value = data.position;
        $("#frame").attr("src", "/" + data.image);
      },
    });
  });

  const today = new Date().toISOString().split("T")[0];
  document.getElementById("datepicker").value = today;

  $(document).ready(function () {
    var id = new URLSearchParams(window.location.search).get("id");
    $("#create-permit").on("click", ".create-permit-btn", function () {
      $('button[type="submit"]').click(function (event) {
        $("[required]").each(function (i, el) {
          if ($(el).val() == "" || $(el).val() == undefined) {
            Swal.fire({
              title: "Failed",
              text: "Please fill in all mandatory fields!",
              icon: "error",
              confirmButtonColor: "#3085d6",
              confirmButtonText: "Yes",
              background: "#ffffff",
            });
            event.preventDefault();
            return false;
          } else {
            $("#create-permit").attr("action", `/update/permit?id=${id}`);

            Swal.fire({
              title: "Success",
              text: "Permit data has been added.",
              icon: "success",
              confirmButtonColor: "#3085d6",
              confirmButtonText: "Yes",
              background: "#ffffff",
            });
          }
        });
      });
    });
  });

  function preview() {
    frame.src = URL.createObjectURL(event.target.files[0]);
  }
  function clearImage() {
    document.getElementById("imagePermit").value = null;
    frame.src = "";
  }
</script>
{{ end }}
